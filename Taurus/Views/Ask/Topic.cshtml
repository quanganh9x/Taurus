@{
    ViewData["Title"] = "Topic";
}


@model Question
@using System.Security.Claims;
<!-- Custom -->
<link href="~/css/qa.css" rel="stylesheet">

<!-- CSS STYLE-->
<link rel="stylesheet" type="text/css" href="https://forum.azyrusthemes.com/css/style.css" media="screen" />

<!-- SLIDER REVOLUTION 4.x CSS SETTINGS -->
<link rel="stylesheet" type="text/css" href="https://forum.azyrusthemes.com/rs-plugin/css/settings.css" media="screen" />

<!-- SLIDER REVOLUTION 4.x SCRIPTS  -->
<script type="text/javascript" src="https://forum.azyrusthemes.com/rs-plugin/js/jquery.themepunch.plugins.min.js"></script>
<script type="text/javascript" src="https://forum.azyrusthemes.com/rs-plugin/js/jquery.themepunch.revolution.min.js"></script>


<div class="container-fluid">

    <section class="content">
        @*<div class="container">
                <div class="row">
                    <div class="col-lg-8 col-xs-12 col-md-8">
                        <div class="pull-left"><a href="#" class="prevnext"><i class="fa fa-angle-left"></i></a></div>
                        <div class="pull-left">
                            <ul class="paginationforum">

                            </ul>
                        </div>
                        <div class="pull-left"><a href="#" class="prevnext last"><i class="fa fa-angle-right"></i></a></div>
                        <div class="clearfix"></div>
                    </div>
                </div>
            </div>*@


        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-md-8">
                    <!-- POST -->
                    <div class="post beforepagination">
                        <div class="topwrap">

                            <div class="posttext pull-left ml-3">
                                <h2>@Model.Title</h2>
                                <p>@Model.Text</p>
                            </div>
                            <div class="clearfix"></div>
                        </div>
                        <div class="postinfobot p-0">


                            <div class="posted pull-left" style="width: initial"><i class="fa fa-clock-o"></i> @Model.CreatedAt.ToString("f") &nbsp;&nbsp;<i class="fa fa-user"></i> @Model.Customer.User.FullName</div>

                            @*<div class="next pull-right">
                                    <a href="#"><i class="fa fa-thumbs-o-up"></i></a>

                                    <a href="#"><i class="fa fa-flag"></i></a>
                                </div>*@

                            <div class="clearfix"></div>
                        </div>
                    </div><!-- POST -->

                    @if (User.IsInRole("Doctor"))
                    {
                        <button type="button" class="btn btn-primary my-3" data-toggle="modal" data-target="#modalSubmitAnswer">
                            + Answer
                        </button>
                    }

                    @foreach (Answer q in ViewData["Answers"] as List<Answer>)
                    {
                        <!-- POST -->
                        <div class="post mt-3">
                            <div class="topwrap">

                                <div class="posttext pull-left ml-3">
                                    <p>@q.Text</p>
                                </div>
                                <div class="clearfix"></div>
                            </div>
                            <div class="postinfobot p-0">



                                <div class="posted pull-left"><i class="fa fa-clock-o"></i> @q.CreatedAt.ToString("f") &nbsp;&nbsp;<i class="fa fa-user"></i> @q.Doctor.User.FullName</div>

                                @if (Model.Customer.UserId == int.Parse(User.FindFirst(ClaimTypes.NameIdentifier).Value) && q.Question.Status == QuestionStatus.ACTIVE)
                                {
                                    <div class="next pull-right">                                        
                                        <a onclick="voteDoctor(this, @q.DoctorId, @q.QuestionId)" class="vote-btn"><i class="fa fa-thumbs-o-up"></i></a>
                                        <a onclick="flagDoctor(this, @q.DoctorId, @q.QuestionId)" class="flag-btn"><i class="fa fa-flag"></i></a>
                                    </div>
                                }

                                <div class="clearfix"></div>
                            </div>
                        </div><!-- POST -->
                    }

                </div>
                <div class="col-lg-4 col-md-4">

                    <!-- -->
                    <div class="sidebarblock">
                        <h3>Specialists</h3>
                        <div class="divline"></div>
                        <div class="blocktxt">
                            <ul class="cats">
                                @foreach (Specialist sp in ViewData["Specialists"] as List<Specialist>)
                                {
                                    <li><a href="#">@sp.Name<span class="badge pull-right">@sp.Questions.Count</span></a></li>
                                }
                            </ul>
                        </div>
                    </div>

                    <!-- -->
                    <!-- -->
                    <div class="sidebarblock">
                        <h3>Active Threads</h3>
                        @foreach (Question qq in ViewData["ActiveThreads"] as List<Question>)
                        {
                            <div class="divline"></div>
                            <div class="blocktxt">
                                <a href="#">@qq.Title</a>
                            </div>
                        }
                    </div>


                </div>
            </div>
        </div>



        @*<div class="container">
                <div class="row">
                    <div class="col-lg-8 col-xs-12">
                        <div class="pull-left"><a href="#" class="prevnext"><i class="fa fa-angle-left"></i></a></div>
                        <div class="pull-left">
                            <ul class="paginationforum">
                                <li class="hidden-xs"><a href="#">1</a></li>
                                <li class="hidden-xs"><a href="#">2</a></li>
                                <li class="hidden-xs"><a href="#">3</a></li>
                                <li class="hidden-xs"><a href="#">4</a></li>
                                <li><a href="#">5</a></li>
                                <li><a href="#">6</a></li>
                                <li><a href="#" class="active">7</a></li>
                                <li><a href="#">8</a></li>
                                <li class="hidden-xs"><a href="#">9</a></li>
                                <li class="hidden-xs"><a href="#">10</a></li>
                                <li class="hidden-xs hidden-md"><a href="#">11</a></li>
                                <li class="hidden-xs hidden-md"><a href="#">12</a></li>
                                <li class="hidden-xs hidden-sm hidden-md"><a href="#">13</a></li>
                                <li><a href="#">1586</a></li>
                            </ul>
                        </div>
                        <div class="pull-left"><a href="#" class="prevnext last"><i class="fa fa-angle-right"></i></a></div>
                        <div class="clearfix"></div>
                    </div>
                </div>
            </div>*@


    </section>


</div>

<div class="modal fade" id="modalSubmitAnswer" tabindex="-1" role="dialog" aria-labelledby="answerTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="answerTitle">Answering</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="answer" method="post" action="@Url.Action("CreateAnswer", "Answer")">
                    <input type="hidden" class="form-control" value="@Model.Id" name="QuestionId">
                    <div class="form-group">
                        <label for="message" class="col-form-label">Text</label>
                        <textarea class="form-control" id="message" name="Text"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" onclick="$('#answer').submit();">Save changes</button>
            </div>
        </div>
    </div>
</div>



<!-- LOOK THE DOCUMENTATION FOR MORE INFORMATIONS -->
<script type="text/javascript">

    var revapi;
    var toast

    $(document).ready(function () {
        "use strict";
        revapi = $('.tp-banner').revolution(
            {
                delay: 15000,
                startwidth: 1200,
                startheight: 278,
                hideThumbs: 10,
                fullWidth: "on"
            });

        window.toast = new Toasty();
    });	//ready

    

    function voteDoctor(e, doctorId, questionId) {
        $.post("@Url.Action("VoteDoctorAnswer", "Vote")", { doctorId: doctorId, questionId: questionId })
                .done(function (resp) {
                    $(e).addClass("voted");
                    $(e).next().addClass("disabled");
                })
                .fail(function (resp) {
                    window.toast.error("You have already voted")                   
                });
    }

    function flagDoctor(e, doctorId, questionId) {        
        $.post("@Url.Action("FlagDoctorAnswer", "Vote")", { doctorId: doctorId, questionId: questionId })
                .done(function (resp) {
                    $(e).addClass("flagged");
                    $(e).prev().addClass("disabled");
                })
                .fail(function (resp) {
                    window.toast.error("You have already voted")
                });
    }

</script>

<!-- END REVOLUTION SLIDER -->
